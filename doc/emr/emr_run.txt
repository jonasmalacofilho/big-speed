SET RUNHASH=4cd199c2f3412f66284c1147cfb327a98fb23dd2

SET AVAILABILITYZONE=sa-east-1b

SET COREBID=0.10
SET TASKBID=0.03

SET MASTERBID=0.50

SET INITIALCORES=16
SET INITIALTASKS=16

ruby elastic-mapreduce-cli.rb --create --alive --name speed --visible-to-all-users --availability-zone %AVAILABILITYZONE% --log-uri s3n://malaco/big-speed/%RUNHASH%/log --enable-debugging --bootstrap-action s3n://malaco/big-speed/%RUNHASH%/bin/speed_boot.sh --bootstrap-name speed_boot --instance-group MASTER --instance-type c1.medium --bid-price %MASTERBID% --instance-count 1 --instance-group CORE --instance-type c1.medium --bid-price %COREBID% --instance-count %INITIALCORES% --instance-group TASK --instance-type c1.medium --bid-price %TASKBID% --instance-dcount %INITIALTASKS% --plain-output
SET JOBID=j-1A41RW5E810JF
ruby elastic-mapreduce-cli.rb --jobflow %JOBID% --stream --step-name all --input s3n://malaco/big-speed/%RUNHASH%/input/gps_data.csv --output s3n://malaco/big-speed/%RUNHASH%/output --mapper speed_mapper --reducer aggregate

ruby elastic-mapreduce-cli.rb --list

SET FULLCORES=16
SET FULLTASKS=48
ruby elastic-mapreduce-cli.rb --jobflow %JOBID% --resize-jobflow --modify-instance-group CORE --instance-count %FULLCORES%
ruby elastic-mapreduce-cli.rb --jobflow %JOBID% --resize-jobflow --modify-instance-group TASK --instance-count %FULLTASKS%

